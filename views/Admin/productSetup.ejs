<!doctype html>

<html lang="en" class="light-style layout-navbar-fixed layout-menu-fixed layout-compact" dir="ltr"
  data-theme="theme-default" data-assets-path="/asset/" data-template="vertical-menu-template" data-style="light">

<head>
  <meta charset="utf-8" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

  <title>eCommerce Add Product - Apps | Vuexy - Bootstrap Admin Template</title>

  <meta name="description" content="" />

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="/asset/img/favicon/favicon.ico" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&ampdisplay=swap"
    rel="stylesheet" />

  <!-- Icons -->
  <link rel="stylesheet" href="/asset/vendor/fonts/fontawesome.css" />
  <link rel="stylesheet" href="/asset/vendor/fonts/tabler-icons.css" />
  <link rel="stylesheet" href="/asset/vendor/fonts/flag-icons.css" />

  <!-- Core CSS -->

  <link rel="stylesheet" href="/asset/vendor/css/rtl/core.css" class="template-customizer-core-css" />
  <link rel="stylesheet" href="/asset/vendor/css/rtl/theme-default.css" class="template-customizer-theme-css" />

  <link rel="stylesheet" href="/asset/css/demo.css" />

  <!-- Vendors CSS -->
  <link rel="stylesheet" href="/asset/vendor/libs/node-waves/node-waves.css" />

  <link rel="stylesheet" href="/asset/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />
  <link rel="stylesheet" href="/asset/vendor/libs/typeahead-js/typeahead.css" />
  <link rel="stylesheet" href="/asset/vendor/libs/quill/typography.css" />
  <link rel="stylesheet" href="/asset/vendor/libs/quill/katex.css" />
  <link rel="stylesheet" href="/asset/vendor/libs/quill/editor.css" />
  <link rel="stylesheet" href="/asset/vendor/libs/select2/select2.css" />
  <link rel="stylesheet" href="/asset/vendor/libs/dropzone/dropzone.css" />
  <link rel="stylesheet" href="/asset/vendor/libs/flatpickr/flatpickr.css" />
  <link rel="stylesheet" href="/asset/vendor/libs/tagify/tagify.css" />

  <!-- Page CSS -->

  <!-- Helpers -->
  <script src="/asset/vendor/js/helpers.js"></script>
  <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->

  <!--? Template customizer: To hide customizer set displayCustomizer value false in config.js.  -->
  <script src="/asset/vendor/js/template-customizer.js"></script>

  <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
  <script src="/asset/js/config.js"></script>
</head>

<body>
  <!-- Layout wrapper -->
  <div class="layout-wrapper layout-content-navbar">
    <div class="layout-container">
      <!-- Menu -->

      <%- include('../layouts/admin/sidebar') %>
        <!-- / Menu -->

        <!-- Layout container -->
        <div class="layout-page">
          <!-- Navbar -->

          <%- include('../layouts/admin/nav') %>

            <!-- / Navbar -->

            <!-- Content wrapper -->
            <div class="content-wrapper">
              <!-- Content -->

              <div class="container-xxl flex-grow-1 container-p-y">
                <div class="app-ecommerce">
                  <!-- Add Product -->
                  <div
                    class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-6 row-gap-4">
                    <div class="d-flex flex-column justify-content-center">
                      <h4 class="mb-1">Add a new Product</h4>
                      <p class="mb-0">Orders placed across your store</p>
                    </div>

                  </div>

                  <div class="row">
                    <!-- First column-->
                    <div class="col-12 col-lg-12">
                      <!-- Product Information -->
                      <div class="card mb-6">
                        <div class="card-header">
                          <h5 class="card-tile mb-0">Product information</h5>
                        </div>
                        <form id="add-product-item">
                          <div class="card-body">
                            <div class="err" id="err"></div>
                            <div class="row mb-6">
                              <div class="col-lg-4 col-md-4 col-sm-12">
                                <label class="form-label" for="ecommerce-product-name">Name</label>
                                <input type="text" class="form-control" id="title" placeholder="Product title"
                                  name=" title" aria-label="Product title " />
                              </div>
                              <div class="col-lg-4 col-md-4 col-sm-12">
                                <label class="form-label" for="ecommerce-product-name">type</label>
                                <input type="text" class="form-control" id="type" placeholder="Product title"
                                  name="type" aria-label="Product type" />
                              </div>
                              <div class="col-lg-4 col-md-4 col-sm-12">
                                <label class="form-label" for="ecommerce-product-sku">image</label>
                                <input type="file" class="form-control" id="image" placeholder="Image" name="image"
                                  aria-label="Product image" />
                              </div>
                            </div>
                            <div class="row mb-6">
                              <div class=" col-lg-4 col-md-4 col-sm-12 ecommerce-select2-dropdown">
                                <label class="form-label " for="vendor"> Category </label>
                                <select id="category_id" name="category_id" class="select2 form-select"
                                  data-placeholder="Select Vendor">
                                  <% category.forEach(ca=> { %>
                                    <option value="<%= ca.id %>">
                                      <%= ca.category_name %>
                                    </option>
                                    <% }); %>
                                </select>
                              </div>
                              <div class=" col-lg-4 col-md-4 col-sm-12 ecommerce-select2-dropdown">
                                <label class="form-label " for="category-org">
                                  <span>Sub Category</span>
                                </label>
                                <select id="sub_category_id" name="sub_category_id" class="select2 form-select"
                                  data-placeholder="Select Category">
                                  <% subCategories.forEach(subca=> { %>
                                    <option value="<%= subca.id %>">
                                      <%= subca.sub_category_name %>
                                    </option>
                                    <% }); %>
                                </select>
                              </div>
                              <div class="col-lg-4 col-md-4 col-sm-12">
                                <label class="form-label" for="ecommerce-product-barcode">Barcode</label>
                                <input type="text" class="form-control" id="barcode" placeholder="0123-4567"
                                  name="barcode" aria-label="Product barcode" />
                              </div>
                            </div>
                            <div class="row mb-6">
                              <div class="col-lg-4 col-md-4 col-sm-12">
                                <label class="form-label" for="ecommerce-product-name">size</label>
                                <input type="number" class="form-control" id="size" placeholder="Product size"
                                  name="size" aria-label="Product size" />
                              </div>
                              <div class="col-lg-4 col-md-4 col-sm-12">
                                <label class="form-label" for="ecommerce-product-name">weight</label>
                                <input type="number" class="form-control" id="weight" placeholder="Product weight"
                                  name="weight" aria-label="Product weight" />
                              </div>
                              <div class="col-lg-4 col-md-4 col-sm-12">
                                <label for="ecommerce-product-tags" class="form-label mb-1">color</label>
                                <input id="color" class="form-control" name="color" aria-label="Product color" />
                              </div>
                            </div>
                            <div class="row mb-6">
                              <div class="col-lg-4 col-md-4 col-sm-12">
                                <label class="form-label" for="ecommerce-product-name">Shipping</label>
                                <input type="text" class="form-control" id="shipping" placeholder="Product Shipping"
                                  name="shipping" aria-label="Product Shipping" />
                              </div>
                              <div class="col-lg-4 col-md-4 col-sm-12">
                                <label class="form-label" for="ecommerce-product-name">Qty</label>
                                <input type="number" class="form-control" id="Qty" placeholder="Product Qty" name="Qty"
                                  aria-label="Product Qty" />
                              </div>
                              <div class="col-lg-4 col-md-4 col-sm-12">
                                <label class="form-label" for="ecommerce-product-name">Future Product</label>
                                <input type="number" class="form-control" id="feature_product"
                                  placeholder="feature product" name="feature_product" aria-label="feature_product" />
                              </div>
                            </div>
                            <!-- Base Price -->
                            <div class="row mb-6">
                              <div class="col-lg-4 col-md-4 col-sm-12">
                                <label class="form-label" for="ecommerce-product-price">Base Price</label>
                                <input type="number" class="form-control" id="price" placeholder="Price" name="price"
                                  aria-label="Product price" />
                              </div>
                              <div class="col-lg-4 col-md-4 col-sm-12">
                                <label class="form-label" for="ecommerce-product-discount-price">Discounted
                                  Price</label>
                                <input type="number" class="form-control" id="discount_price"
                                  placeholder="Discounted Price" name="discount_price"
                                  aria-label="Product discounted price" />
                              </div>
                              <div class="col-lg-4 col-md-4 col-sm-12">
                                <label for="ecommerce-product-tags" class="form-label mb-1">tag</label>
                                <input id="tag" class="form-control" name="tag" aria-label="Product tags" />
                              </div>
                            </div>
                            <!-- Description -->
                            <div class="mb-6 col-12">
                              <label class="mb-1">Description (Optional)</label>
                              <textarea name="description" class="form-control" id="description" cols="4"
                                rows="4"></textarea>
                            </div>
                            <div class="d-flex align-content-center flex-wrap gap-4">

                              <button type="submit"  class="btn btn-primary">
                                <span class="spinner-border1" role="status" aria-hidden="true"></span>&nbsp;
                                Publish product
                              </button>
                            </div>
                          </div>
                        </form>
                      </div>
                      <!-- /Product Information -->


                      <!-- Footer -->
                      <%- include('../layouts/admin/copywrite') %>
                        <!-- / Footer -->

                        <div class="content-backdrop fade"></div>
                    </div>
                    <!-- Content wrapper -->
                  </div>
                  <!-- / Layout page -->
                </div>

                <!-- Overlay -->
                <div class="layout-overlay layout-menu-toggle"></div>

                <!-- Drag Target Area To SlideIn Menu On Small Screens -->
                <div class="drag-target"></div>
              </div>
              <!-- / Layout wrapper -->

              <!-- Core JS -->
              <!-- build:js assets/vendor/js/core.js -->

              <script src="/asset/vendor/libs/jquery/jquery.js"></script>
              <script src="/asset/vendor/libs/popper/popper.js"></script>
              <script src="/asset/vendor/js/bootstrap.js"></script>
              <script src="/asset/vendor/libs/node-waves/node-waves.js"></script>
              <script src="/asset/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
              <script src="/asset/vendor/libs/hammer/hammer.js"></script>
              <script src="/asset/vendor/libs/i18n/i18n.js"></script>
              <script src="/asset/vendor/libs/typeahead-js/typeahead.js"></script>
              <script src="/asset/vendor/js/menu.js"></script>

              <!-- endbuild -->

              <!-- Vendors JS -->
              <script src="/asset/vendor/libs/quill/katex.js"></script>
              <script src="/asset/vendor/libs/quill/quill.js"></script>
              <script src="/asset/vendor/libs/select2/select2.js"></script>
              <script src="/asset/vendor/libs/dropzone/dropzone.js"></script>
              <script src="/asset/vendor/libs/jquery-repeater/jquery-repeater.js"></script>
              <script src="/asset/vendor/libs/flatpickr/flatpickr.js"></script>
              <script src="/asset/vendor/libs/tagify/tagify.js"></script>
              <script src="/asset/vendor/libs/toastr/toastr.js"></script>
              <!-- Main JS -->
              <script src="/asset/js/main.js"></script>

              <!-- Page JS -->
              <script src="/asset/js/app-ecommerce-product-add.js"></script>
              <script>

                if (document.getElementById("add-product-item")) {
                  const err = document.getElementById("err");
                  $(".spinner-border").hide()
                  document.getElementById("add-product-item").addEventListener("submit", async function (e) {
                    e.preventDefault()
                    $(".spinner-border").show()
                    const formData = new FormData();

                    const title = document.getElementById('title');
                    const description = document.getElementById('description');
                    const type = document.getElementById('type');
                    const feature_product = document.getElementById('feature_product');
                    const price = document.getElementById('price');
                    const discount_price = document.getElementById('discount_price');
                    const size = document.getElementById('size');
                    const color = document.getElementById('color');
                    const weight = document.getElementById('weight');
                    const Qty = document.getElementById('Qty');
                    const category_id = document.getElementById('category_id');
                    const sub_category_id = document.getElementById('sub_category_id');
                    const shipping = document.getElementById('shipping');
                    const barcode = document.getElementById('barcode');
                    const tag = document.getElementById('tag');
                    const fileInput = document.getElementById('image');


                    formData.append('title', title.value)
                    formData.append('description', description.value)
                    formData.append('type', type.value)
                    formData.append('feature_product', feature_product.value)
                    formData.append('price', price.value)
                    formData.append('discount_price', discount_price.value)
                    formData.append('size', size.value)
                    formData.append('color', color.value)
                    formData.append('weight', weight.value)
                    formData.append('Qty', Qty.value)
                    formData.append('category_id', category_id.value)
                    formData.append('sub_category_id', sub_category_id.value)
                    formData.append('shipping', shipping.value)
                    formData.append('barcode', barcode.value)
                    formData.append('tag', tag.value)
                    formData.append('image', fileInput.files[0])
                    
                    try {
                      const response = await fetch('/setup/create-product', {
                        method: "POST",
                        body: formData,
                        // headers: {
                        //     "Content-Type": "application/json"
                        // }
                      })

                      // const result = await response.json();

                      if (response.ok) {
                        $(".spinner-border").hide()
                        // const result = await response.json();
                        toastr.success(response.message);
                        setTimeout(() => {
                          location.reload()
                        }, "2000");
                      } else {
                        $(".spinner-border").hide()
                        // const error = await response.text();
                        toastr.error(result.message);
                        err.textContent = result.message
                        err.style = "color: red";
                      }
                    } catch (error) {
                      $(".spinner-border").hide()
                      toastr.error(error.message);
                      err.textContent = error.message
                      err.style = "color: red";
                    }
                  })
                }
                // document.getElementById("Category").addEventListener("change", subCategory);
                // async function subCategory() {
                // const value = this.value
                // const request = await fetch('/setup/sub_category/' + value)
                // const response = await request.json();
                // console.log(response)
                // createSelectOption(response)
                // console.log(value)
                // }

               // function createSelectOption(rows, id) {
                  // $('#cover-spin').hide(0)
                  // const selection = document.getElementById("subcategory");
                  // selection.innerHTML = "";
                  // const option1 = document.createElement("option");
                  // option1.value = "";
                  // option1.textContent = "Select option";
                  // selection.appendChild(option1);
                  // rows.forEach((st) => {
                   //  const option = document.createElement("option");
                   //  option.value = st.id;
                   //  option.textContent = st.sub_category_name;
                   //  selection.appendChild(option);
                  // });
                // }


                async function deleteCourse(id) {
                  if (confirm("Are you sure you want to delete this course and all the associated video?") == true) {
                    // alert({video_id, course_id})
                    try {
                      const req = await fetch(`/users/courses/delete/video/${id}`)
                      if (req.ok) {
                        const res = req.json();
                        if (res.status == true) {
                          toastr.success(res.message);
                          setTimeout(() => {
                            location.reload()
                          }, "2000");
                        } else {
                          toastr.error(res.message);

                        }
                      } else {
                        toastr.error(await errorMessage(req));
                      }
                    } catch (error) {
                      toastr.error(error.message);
                    }
                  }
                }


                async function errorMessage(req) {
                  const error = await req.text();
                  const gh = JSON.parse(error)
                  return gh.message
                }


                // convert building image to base64 url 
                const fileInput = document.getElementById('image');
                fileInput.addEventListener('change', async (e) => {
                  $('#cover-spin').show(0)
                  const file = fileInput.files[0];

                  const reader = new FileReader();
                  reader.addEventListener('load', async () => {

                    // console.log(reader.result)
                    // formData.append('file', reader.result);
                    // formData.append('upload_preset', 'hokolo');


                    $("#base64url").val(reader.result)

                  })
                  reader.readAsDataURL(file)
                });

              </script>
</body>

</html>